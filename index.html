<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Switcher with Custom Controls</title>
    <style>
        body {
            text-align: center;
            margin: 0;
            overflow: hidden; /* Nasconde eventuali barre di scorrimento */
        }
        .video-container {
            position: relative;
            display: inline-block;
            width: 100vw; /* Usa tutta la larghezza della finestra */
            height: 100vh; /* Usa tutta l'altezza della finestra */
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none; /* Rimuovi bordi dall'iframe */
        }
        .controls {
            position: absolute;
            bottom: 20px; /* Posiziona i controlli a 20px dal fondo */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10;
        }
        .controls button,
        .fullscreen-button {
            color: white;
            background: rgba(51, 51, 51, 0.8); /* Sfondo semi-trasparente per i pulsanti */
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 20px;
            font-size: 14px;
        }
        .fullscreen-button {
            position: absolute;
            top: 10px; /* Posiziona il pulsante fullscreen in alto a destra */
            right: 10px;
        }
        .error-message {
            color: red;
            font-size: 18px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="video-container" id="videoContainer">
        <iframe id="video1" src="" title="Video 1" style="display:none;"></iframe>
        <iframe id="video2" src="" title="Video 2" style="display:none;"></iframe>
        <div class="controls">
            <button id="backward">-5</button>
            <button id="switchButton">Switch Video</button>
            <button id="forward">+5</button>
        </div>
        <button class="fullscreen-button" id="fullscreenBtn">Fullscreen</button>
    </div>
    <div id="errorMessage" class="error-message" style="display:none;"></div>

    <script src="https://player.vimeo.com/api/player.js"></script>
    <script>
        // Aggiungi il tuo access token qui
        const accessToken = 'a9b22d79485ad20611e2902ee3096dfe'; // Inserisci il tuo access token Vimeo

        const video1 = document.getElementById('video1');
        const video2 = document.getElementById('video2');
        const errorMessage = document.getElementById('errorMessage');
        const switchButton = document.getElementById('switchButton');
        const forwardButton = document.getElementById('forward');
        const backwardButton = document.getElementById('backward');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const videoContainer = document.getElementById('videoContainer');

        let player1, player2;
        let currentPlayer;

        // Mappa di esempio per associare matchID a video Vimeo
        const videoAssociations = {
            "1234": ["123456789", "987654321"], // Sostituisci con i tuoi video ID
            "5678": ["234567890", "876543210"]  // Altri matchID con relativi video
        };

        // Funzione per ottenere i video in base alla query string
        function loadVideos() {
            const urlParams = new URLSearchParams(window.location.search);
            const matchID = urlParams.get('matchID');

            if (matchID && videoAssociations[matchID]) {
                const [videoID1, videoID2] = videoAssociations[matchID];
                video1.src = `https://player.vimeo.com/video/${videoID1}`;
                video2.src = `https://player.vimeo.com/video/${videoID2}`;
                video1.style.display = 'block';
                video2.style.display = 'block';

                // Inizializza i player
                player1 = new Vimeo.Player(video1);
                player2 = new Vimeo.Player(video2);
                currentPlayer = player1;
            } else if (matchID) {
                // Mostra errore se matchID non è valido
                errorMessage.textContent = 'Errore: matchID non trovato!';
                errorMessage.style.display = 'block';
            } else {
                // Se non c'è matchID, carica gli ultimi video
                getVimeoVideos();
            }
        }

        // Funzione per ottenere gli ultimi video dal tuo account Vimeo
        function getVimeoVideos() {
            fetch('https://api.vimeo.com/me/videos', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                const videos = data.data;
                if (videos.length > 0) {
                    const firstVideo = videos[0];
                    const secondVideo = videos.length > 1 ? videos[1] : null;

                    video1.src = `https://player.vimeo.com/video/${firstVideo.uri.split('/')[2]}`;
                    video1.style.display = 'block';
                    player1 = new Vimeo.Player(video1);

                    if (secondVideo) {
                        video2.src = `https://player.vimeo.com/video/${secondVideo.uri.split('/')[2]}`;
                        video2.style.display = 'block';
                        player2 = new Vimeo.Player(video2);
                    }
                    currentPlayer = player1;
                }
            })
            .catch(error => {
                console.error('Errore nel recupero dei video:', error);
                errorMessage.textContent = 'Errore nel caricamento dei video!';
                errorMessage.style.display = 'block';
            });
        }

        // Gestione degli eventi dei pulsanti
        switchButton.addEventListener('click', () => {
            currentPlayer.getCurrentTime().then(currentTime => {
                const otherPlayer = currentPlayer === player1 ? player2 : player1;
                currentPlayer.pause().then(() => {
                    if (currentPlayer === player1) {
                        video1.style.display = 'none';
                        video2.style.display = 'block';
                    } else {
                        video2.style.display = 'none';
                        video1.style.display = 'block';
                    }
                    otherPlayer.setCurrentTime(currentTime).then(() => {
                        otherPlayer.play();
                    }).catch(error => {
                        console.error('Errore nel riprodurre il video:', error);
                    });
                    currentPlayer = otherPlayer;
                });
            });
        });

        forwardButton.addEventListener('click', () => {
            currentPlayer.getCurrentTime().then(seconds => {
                currentPlayer.setCurrentTime(seconds + 5);
            });
        });

        backwardButton.addEventListener('click', () => {
            currentPlayer.getCurrentTime().then(seconds => {
                currentPlayer.setCurrentTime(Math.max(0, seconds - 5));
            });
        });

        fullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                videoContainer.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });

        document.addEventListener('fullscreenchange', () => {
            fullscreenBtn.innerText = document.fullscreenElement ? 'Exit Fullscreen' : 'Fullscreen';
        });

        // Chiamata iniziale per caricare i video
        loadVideos();
    </script>
</body>
</html>
